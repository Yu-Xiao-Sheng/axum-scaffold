{{#if has_auth}}
use axum::{
    http::StatusCode,
    response::IntoResponse,
    Json,
    routing::post,
    Router,
};
use serde::{Deserialize, Serialize};

/// Login request
#[derive(Debug, Deserialize)]
pub struct LoginRequest {
    pub username: String,
    pub password: String,
}

/// Register request
#[derive(Debug, Deserialize)]
pub struct RegisterRequest {
    pub username: String,
    pub email: String,
    pub password: String,
}

/// Auth response
#[derive(Debug, Serialize)]
pub struct AuthResponse {
    pub token: String,
    pub username: String,
}

/// Handler: POST /auth/login
///
/// TODO: Implement actual login logic:
{{#if has_database}}
///   1. Query user from database using sqlx
///   2. Verify password with bcrypt
{{else}}
///   1. Verify credentials against your data source
{{/if}}
///   3. Generate JWT token with jsonwebtoken crate
pub async fn login(
    Json(req): Json<LoginRequest>,
) -> Result<impl IntoResponse, StatusCode> {
    // Placeholder response - replace with real implementation
    let _password = req.password; // TODO: verify password
    let response = AuthResponse {
        token: "placeholder_jwt_token".to_string(),
        username: req.username,
    };

    Ok(Json(response))
}

/// Handler: POST /auth/register
///
/// TODO: Implement actual registration logic:
{{#if has_database}}
///   1. Hash password with bcrypt
///   2. Insert user into database using sqlx
{{else}}
///   1. Hash password with bcrypt
///   2. Store user in your data source
{{/if}}
///   3. Generate JWT token with jsonwebtoken crate
pub async fn register(
    Json(req): Json<RegisterRequest>,
) -> Result<impl IntoResponse, StatusCode> {
    // Placeholder response - replace with real implementation
    let _password = req.password; // TODO: hash with bcrypt
    let _email = req.email; // TODO: validate and store
    let response = AuthResponse {
        token: "placeholder_jwt_token".to_string(),
        username: req.username,
    };

    Ok(Json(response))
}

/// Router for authentication routes
pub fn router() -> Router {
    Router::new()
        .route("/auth/login", post(login))
        .route("/auth/register", post(register))
}
{{/if}}
